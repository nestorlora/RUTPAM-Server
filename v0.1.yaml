openapi: 3.0.1
info:
  title: RUTPAM API
  version: 0.2.0
  description: >
    Esta API provee y lee datos de forma centralizada  al servidor RUTPAM.
    Estandariza información general de la red de transportes  de múltiples
    formatos y modelos bajo una integración general
  contact:
    name: Nestor Lora
    email: nestorlora@geeklab.es
  license:
    name: MIT
servers:
  - url: 'http://rutpam.titan.geeklab.es:5000'
    description: Servidor de desarrollo HTTP
paths:
  /info:
    summary: Información del servidor
    get:
      summary: Obtener información
      description: Devuelve la información de la instancia
      operationId: get_info
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                    description: Versión del servidor
                    example: 1.0.0
                  contacto:
                    type: string
                    description: Email de contacto
                    example: webmaster@localhost
                  web:
                    type: string
                    description: Sitio web
                    example: 'http://localhost/RUTPAM'
                  mantenimiento:
                    type: boolean
                    description: Indica si el servidor está en mantenimiento
                    example: false
      tags:
        - Información
  /tipos_subida_bajada:
    summary: Tipos de subidas y bajadas en paradas
    get:
      summary: Obtener tipos de subida y bajada
      description: Devuelve la tabla de tipos de subida y bajada
      parameters:
        - in: query
          name: id
          description: ID del tipo
          required: false
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tipo_subida_bajada'
      tags:
        - DB
    post:
      summary: Obtener tipos de subida y bajada
      description: Devuelve la tabla de tipos de subida y bajada
      security:
        - Agent: []
        - Admin: []
      parameters:
        - in: query
          name: id
          description: ID del tipo
          required: false
          schema:
            type: integer
            format: int32
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Tipo_subida_bajada'
        '401':
          $ref: '#/components/responses/401Unauthorized'
      tags:
        - DB
components:
  schemas:
    Estacion:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador de la estación en la base de datos
          example: 134846
        eid:
          type: string
          description: Identificador externo de la estación en su red
          example: 41
        nombre:
          type: string
          description: Nombre de la parada
          example: Málaga-María Zambrano
        direccion:
          type: string
          description: Dirección postal de la parada (si la tiene)
          example: Paseo del Parque 21
        ubicacion:
          $ref: '#/components/schemas/LatLong'
    Informacion_operador:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador de la relación en la base de datos
          example: 134846
        operador:
          type: integer
          format: int64
          description: Identificador del operador en la base de datos
          example: 134846
        tipo:
          type: integer
          format: int64
          description: Identificador del tipo en la base de datos
          example: 134846
        informacion:
          type: string
          description: Información perteneciente al operador
          example: reservas@malaga.avanzabus.es
        descripcion:
          type: string
          description: Información adicional referida al dato anterior
          example: Reservas
    Itinerario:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador del itinerario en la base de datos
          example: 1654135
        linea:
          type: integer
          format: int64
          description: Identificador de la línea en la base de datos
          example: 134846
        eid:
          type: string
          description: Identificador externo del itinerario en su red
          example: '41.5'
        tipo:
          type: integer
          format: int64
          description: Identificador del sentido (Ida/Vuelta/Circular/Posicionamiento)
          example: 1
        destino:
          type: string
          description: Headsign o indicacion de destino
          example: El Palo
        descripcion:
          type: string
          description: Descripción del sentido
          example: Ida. Itinerario 1
        fechaInicio:
          type: string
          format: date-time
          description: >
            Fecha en la que la línea comienza su actividad (para este id) La
            base de datos puede contener otras versiones de la línea con otros
            id
          example: '2019-08-19'
        fechaFin:
          type: string
          format: date-time
          description: >
            Fecha en la que la línea comienza su actividad (para este id) La
            base de datos puede contener otras versiones de la línea con otros
            id
          example: '2019-08-19'
    Linea:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador de la línea en la base de datos
          example: 134846
        red:
          type: integer
          format: int32
          description: Identificador de la red en la base de datos
          example: 2
        eid:
          type: string
          description: Identificador externo de la línea en su red
          example: 41
        codigo:
          type: string
          description: Nombre corto o código que ven los viajeros
          example: N1
        nombre:
          type: string
          description: Nombre de la línea
          example: Puerta Blanca - Alameda Principal - El Palo
        observaciones:
          type: string
          description: Información adicional sobre la línea
          example: Traslado de paradas por obras en Alameda Ppal
        fechaInicio:
          type: string
          format: date-time
          description: >
            Fecha en la que la línea comienza su actividad (para este id) La
            base de datos puede contener otras versiones de la línea con otros
            id
          example: '2019-08-19'
        fechaFin:
          type: string
          format: date-time
          description: >
            Fecha en la que la línea comienza su actividad (para este id) La
            base de datos puede contener otras versiones de la línea con otros
            id
          example: '2019-08-19'
        color:
          type: string
          description: Color Hex de la línea
          example: 00FF00
        colorTexto:
          type: string
          description: Color Hex del texto para los badges de la línea
          example: FFFFFF
        url:
          type: string
          description: URL con información de la línea
          example: 'https://emtmalaga.es'
        tipo_gtfs:
          type: integer
          format: int32
          description: >
            Extensión de tipo de ruta GTFS. Leyenda en [Google
            Dev](https://developers.google.com/transit/gtfs/reference/extended-route-types?hl=es)
          example: 7200
    Municipio:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador del municipio en la base de datos
          example: 134846
        nombre:
          type: string
          description: Nombre del municipio
          example: Álora
    Nucleo:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador del núcleo en la base de datos
          example: 134846
        nombre:
          type: string
          description: Nombre del núcleo
          example: Aeropuerto
        municipio:
          type: integer
          format: int64
          description: Identificador del municipio en la base de datos
          example: 134846
    Operador:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador del operador
          example: 5
        nombre:
          type: string
          description: Nombre del operador
          example: 'Avanza Movilidad Urbana, S.L.U'
    Operadores_linea:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador del operador
          example: 5
        linea:
          type: integer
          format: int64
          description: Identificador de la línea en la base de datos
          example: 134846
        operador:
          type: integer
          format: int32
          description: Identificador del operador
          example: 5
        rol:
          type: integer
          format: int32
          description: Identificador del rol
          example: 5
        fechaInicio:
          type: string
          format: date-time
          description: >
            Fecha en la que la línea comienza su actividad (para este id) La
            base de datos puede contener otras versiones de la línea con otros
            id
          example: '2019-08-19'
        fechaFin:
          type: string
          format: date-time
          description: >
            Fecha en la que la línea comienza su actividad (para este id) La
            base de datos puede contener otras versiones de la línea con otros
            id
          example: '2019-08-19'
    Parada:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador de la parada en la base de datos
          example: 5423
        eid:
          type: string
          description: Identificador externo de la parada en su red
          example: 41
        nombre:
          type: string
          description: Nombre de la parada
          example: Alameda Principal - Sur
        nucleo:
          type: integer
          format: int32
          description: Identificador del núcleo al que pertenece la parada
          example: 175
        estacion:
          type: integer
          format: int64
          description: >-
            Identificador de la estación a la que pertenece esta parada (si la
            hay)
          example: 134846
        plataforma:
          type: string
          description: Nombre/texto/referencia del andén o plataforma dentro de la estación
          example: 4B
        red:
          type: integer
          format: int64
          description: Identificador de la red
          example: 7
        zona:
          type: integer
          format: int32
          description: Identificador de la zona a la que pertenece la parada
          example: 3
        direccion:
          type: string
          description: Dirección postal de la parada (si la tiene)
          example: Paseo del Parque 21
        ubicacion:
          $ref: '#/components/schemas/LatLong'
        fechaInicio:
          type: string
          format: date-time
          description: >
            Fecha en la que la línea comienza su actividad (para este id) La
            base de datos puede contener otras versiones de la línea con otros
            id
          example: '2019-08-19'
        fechaFin:
          type: string
          format: date-time
          description: >
            Fecha en la que la línea comienza su actividad (para este id) La
            base de datos puede contener otras versiones de la línea con otros
            id
          example: '2019-08-19'
    Paradas_itinerario:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador de la relacion
          example: 5654
        itinerario:
          type: integer
          format: int64
          description: Identificador del itinerario en la base de datos
          example: 1654135
        parada:
          type: integer
          format: int32
          description: Identificador de la parada en la base de datos
          example: 5423
        tipo_subida:
          type: integer
          format: int32
          description: Identificador del tipo de subida/bajada
          example: 56
        tipo_bajada:
          type: integer
          format: int32
          description: Identificador del tipo de subida/bajada
          example: 56
        orden:
          type: integer
          format: int32
          description: Número de orden de la parada en la secuencia del itinerario
          example: 14
    Punto:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador del punto
          example: 3243541
        ubicacion:
          $ref: '#/components/schemas/LatLong'
    Punto_trazado:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador de la relación
          example: 56
        trazado:
          type: integer
          format: int32
          description: Identificador del trazado
          example: 3243
        punto:
          type: integer
          format: int64
          description: Identificador del punto
          example: 3243541
        orden:
          type: integer
          format: int32
          description: Número de orden del punto en la secuencia del trazado
          example: 14
    Punto_venta:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador del punto
          example: 3243541
        operador:
          type: integer
          format: int32
          description: Identificador del operador
          example: 5
        nucleo:
          type: integer
          format: int64
          description: Identificador del núcleo en la base de datos
          example: 134846
        tipo:
          type: integer
          format: int32
          description: Identificador del tipo
          example: 56
        direccion:
          type: string
          description: Dirección postal del punto (si la tiene)
          example: Paseo del Parque 21
        ubicacion:
          $ref: '#/components/schemas/LatLong'
    Red:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador de la red
          example: 5
        nombre:
          type: string
          description: Nombre de la red
          example: Renfe
    Rol_operador:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador del rol
          example: 5
        rol:
          type: string
          description: Nombre del rol
          example: Planificación
        descripcion:
          type: string
          description: Descripción del rol
          example: 'Gestión de horarios, desvíos, refuerzos, etc...'
    Tipo_informacion:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador del tipo en la base de datos
          example: 134846
        tipo:
          type: string
          description: Nombre del tipo
          example: URL
    Tipo_itinerario:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador del tipo en la base de datos
          example: 134846
        tipo:
          type: string
          description: Nombre del tipo
          example: Posicionamiento
        descripcion:
          type: string
          description: Descripción del sentido
          example: Movimiento sin pasajeros al comenzar o terminar el servicio
    Tipo_punto_venta:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador del tipo
          example: 56
        tipo:
          type: string
          description: Nombre del tipo
          example: Estanco
    Tipo_subida_bajada:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador del tipo de subida/bajada
          example: 56
        tipo:
          type: string
          description: Nombre del tipo
          example: Avisar conductor
        descripcion:
          type: string
          description: Información explicativa del tipo
          example: Es necesario avisar al conductor para realizar la parada
    Tipo_transbordo:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador del tipo de transbordo
          example: 56
        tipo:
          type: string
          description: Nombre del tipo
          example: Programado
        descripcion:
          type: string
          description: Información explicativa del tipo
          example: El vehículo espera a los viajeros que van a transbordar
    Tipo_linea_gtfs:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador del tipo de transporte
          example: 101
        descripcion:
          type: string
          description: Nombre del tipo
          example: Servicio ferroviario de alta velocidad
        ejemplos:
          type: string
          description: Información explicativa del tipo
          example: 'TGV (FR), ICE (DE), Eurostar (GB)'
      description: >-
        Leyenda en [Google
        Dev](https://developers.google.com/transit/gtfs/reference/extended-route-types?hl=es)
    Transbordo:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Identificador del transbordo
          example: 3234854
        parada1:
          type: integer
          format: int32
          description: Identificador de la parada en la base de datos
          example: 5423
        parada2:
          type: integer
          format: int32
          description: Identificador de la parada en la base de datos
          example: 5423
        tipo:
          type: integer
          format: int32
          description: Identificador del tipo de transbordo
          example: 56
        tiempo_minimo:
          type: integer
          format: int32
          description: Minutos necesarios para hacer el transbordo (si son necesarios)
    Trazado:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador del trazado en la base de datos
          example: 5423
        color:
          type: string
          description: Color HTML de la polilínea
          example: '#009639'
        transparencia:
          type: number
          format: float
          description: Porcentaje de transparencia de la polilínea
          example: 1
    Zona:
      type: object
      properties:
        id:
          type: integer
          format: int32
          description: Identificador de la zona
          example: 5
        red:
          type: integer
          format: int32
          description: Identificador de la red
          example: 5
        nombre:
          type: string
          description: Nombre de la zona
          example: A
    LatLong:
      type: object
      properties:
        lat:
          type: number
          format: float
          example: 36.6916079
        lon:
          type: number
          format: float
          example: -4.4561347
      required:
        - lat
        - lon
    ApiResponse:
      type: object
      properties:
        code:
          type: number
          format: int32
          example: 404
        status:
          type: string
          example: 'User not found'
  securitySchemes:
    User:
      type: apiKey
      in: query
      name: userKey
    Agent:
      type: apiKey
      in: query
      name: agentKey
    Admin:
      type: apiKey
      in: query
      name: opKey
  responses:
    401Unauthorized:
      description: Unauthorized (Token key is not provided, is invalid, or is expired)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiResponse'
tags:
  - name: Información
    description: Información general de la instancia
  - name: DB
    description: Operaciones básicas sobre la BBDD
